Steps of preparing input files for NCAR routing model:

1. Given a stream outlet location, find its segment ID using arcGIS.

2. Find all upstream segs and HRUs of the outlet, and output arcpy format results
	Running 'find_all_upstreams.py'
		Input: change 'parameter' section in the script
		Output: qry_segID_[outletID].pk; qry_hruID_[outletID].pk

3. Export these segments and HRUs as shapefiles
	1. Copy 'qry_segID_[outletID].pk' and 'qry_hruID_[outletID].pk' to /nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/input.
	2. Run arc python script '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/selecting_seg_hru.txt' (need to change the settings at the beginning of the script).
		Output: shapefiles '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/upstream_segments_[outletID]' and '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/upstream_hrus_[outletID]'
	3. Copy the segments and HRUs shapefiles back to hydra (be sure to copy all related files), e.g., to ./output/

4. Manually check the above shapefiles!!!!!!
	Check if they look correct. They should be a complete watershed upstream of the outlet.

5. Make a raster file for VIC grids needed
	#========== If already has a point shapefile of the original big lat lon grid, skip steps 1-3. ========#
	1. Make a xyz file of lat lon
		3 columns: <lat> <lon> <one>  (the last column is all 1)
		The file should have the header line: "lat lon one"
		The file name must has extension .txt
		e.g., Livneh_latlon_list_conus_xyz.txt
	2. Copy this file to '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/input'
	3. Make a point shapefile of the lat lon grid, put in '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/input'
	4. Run arc python script '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/make_vic_raster.txt' (need to change the settings at the beginning of the script)
		Input: the big latlon point shapefile and HRU shapefile of the complete watershed
		Output:
			Raster file of the latlon grid containing the whole watershed: '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/ras_[outletID]'
			A list of latlon needed to be run by VIC: '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/latlon_[outletID]'  (only the 3rd and 4th columns are useful)

6. Manually chec the above raster file!!!!!!
	Check if it contains the whole HRU watershed.

7.1 Running VIC for the needed grid cells
	Run VIC for the lat and lon listed in: '/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/latlon_[outletID]' (only the 3rd and 4th columns are useful)

7.2 Calculate weights
	1. Copy the raster file ('/nfs/jet/tools/SAMBA/ymao/VIC_RBM_east/GIS/preprocessing/output/ras_[outletID]') to hydra (need to copy all files consisting the raster file). e.g., to ./output/ras_[outletID]
	2. Run script: grid2shp.py
		This convert the latlon raster to polygon shapefile
		Usage: python grid2shp.py <path to raster> <path to output shapefile>
		Example: python ./scripts/grid2shp.py ./input/ras_[outletID]/ras_[outletID] ./output/latlon_grid_[outletID].shp
	3. Run script: poly2poly.py
		This calculates weights of overlaping gridcells for each HRUs
		Usage: python poly2poly.py <HRU shapefile> <name of hru id filed> <grid cell shapefile> <grid cell id field (id)> GRID <output weights nc file>
		Example: python ./scripts/poly2poly.py ./output/upstream_hrus_[outletID].shp hru_id2 ./output/latlon_grid_[outletID].shp id GRID ./output/hru_weights_[outletID].nc







./create_hru_sgtavg_nc.scr Calc_hru_wgtavg_nc.py ./output/hru_weight.nc ./input/vic_runoff_test.nc RUNOFF None junk.nc


